# CURSOR PROMPT: Configure Custom Domain - fincenclear.com

## OBJECTIVE

Configure the application to work with the new custom domain `fincenclear.com`. This involves updating CORS settings, environment variables, and any hardcoded URLs.

---

## PART 1: Update CORS Configuration

**File:** `api/app/main.py`

Find the CORS middleware configuration and update `allow_origins` to include the new domain:

```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        # Local development
        "http://localhost:3000",
        "http://localhost:3001",
        
        # Vercel deployments (keep for preview URLs)
        "https://pct-fin-cen-6wx3.vercel.app",
        
        # Production domain - NEW
        "https://fincenclear.com",
        "https://www.fincenclear.com",
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**Alternative - Use environment variable for flexibility:**

```python
import os

# Get allowed origins from env, with defaults
allowed_origins_str = os.getenv(
    "ALLOWED_ORIGINS",
    "http://localhost:3000,https://fincenclear.com,https://www.fincenclear.com"
)
allowed_origins = [origin.strip() for origin in allowed_origins_str.split(",")]

app.add_middleware(
    CORSMiddleware,
    allow_origins=allowed_origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## PART 2: Update Environment Files

### Frontend - Vercel Environment Variables

**File:** `web/.env.production` (create if doesn't exist)

```bash
# API Configuration
NEXT_PUBLIC_API_BASE_URL=https://pct-fin-cen-staging.onrender.com

# Demo Mode
NEXT_PUBLIC_DEMO_MODE=true

# Site URL (for metadata, OpenGraph, etc.)
NEXT_PUBLIC_SITE_URL=https://fincenclear.com
```

**File:** `web/.env.local` (for local development)

```bash
# Local API
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000

# Demo Mode
NEXT_PUBLIC_DEMO_MODE=true

# Site URL
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

### Backend - Render Environment Variables

Add these in Render Dashboard â†’ Environment:

```bash
ALLOWED_ORIGINS=http://localhost:3000,https://pct-fin-cen-6wx3.vercel.app,https://fincenclear.com,https://www.fincenclear.com
```

---

## PART 3: Update Metadata & SEO

**File:** `web/app/layout.tsx`

Update the metadata to use the production domain:

```tsx
import { Metadata } from "next";

export const metadata: Metadata = {
  metadataBase: new URL(
    process.env.NEXT_PUBLIC_SITE_URL || "https://fincenclear.com"
  ),
  title: {
    default: "FinCEN Clear - FinCEN Compliance Made Simple",
    template: "%s | FinCEN Clear",
  },
  description:
    "The most comprehensive FinCEN Real Estate Reporting compliance platform for title companies. Determine requirements in 2 minutes. File in 10 minutes.",
  keywords: [
    "FinCEN",
    "Real Estate Reporting",
    "Compliance",
    "Title Company",
    "BOI",
    "Beneficial Ownership",
  ],
  authors: [{ name: "PCT FinCEN Solutions" }],
  creator: "PCT FinCEN Solutions",
  openGraph: {
    type: "website",
    locale: "en_US",
    url: "https://fincenclear.com",
    siteName: "FinCEN Clear",
    title: "FinCEN Clear - FinCEN Compliance Made Simple",
    description:
      "The most comprehensive FinCEN Real Estate Reporting compliance platform for title companies.",
    images: [
      {
        url: "/og-image.png",
        width: 1200,
        height: 630,
        alt: "FinCEN Clear",
      },
    ],
  },
  twitter: {
    card: "summary_large_image",
    title: "FinCEN Clear - FinCEN Compliance Made Simple",
    description:
      "The most comprehensive FinCEN Real Estate Reporting compliance platform for title companies.",
    images: ["/og-image.png"],
  },
  robots: {
    index: true,
    follow: true,
  },
};
```

---

## PART 4: Update Any Hardcoded URLs

Search the codebase for any hardcoded URLs and update them:

### Search for these patterns:
```bash
# In terminal, run:
grep -r "pct-fin-cen" web/
grep -r "vercel.app" web/
grep -r "localhost:3000" web/  # Check these aren't in production code
```

### Common places to check:

**Email templates (if any):**
```typescript
// BEFORE
const portalUrl = `https://pct-fin-cen-6wx3.vercel.app/p/${token}`;

// AFTER
const portalUrl = `${process.env.NEXT_PUBLIC_SITE_URL}/p/${token}`;
```

**API client configuration:**
```typescript
// BEFORE (hardcoded)
const API_URL = "https://pct-fin-cen-staging.onrender.com";

// AFTER (use env var)
const API_URL = process.env.NEXT_PUBLIC_API_BASE_URL;
```

**Party portal links generated by backend:**

**File:** `api/app/routes/reports.py` (or wherever party links are generated)

```python
import os

# Get base URL from environment
FRONTEND_URL = os.getenv("FRONTEND_URL", "https://fincenclear.com")

# When generating party portal links:
portal_link = f"{FRONTEND_URL}/p/{token}"
```

Add to Render environment variables:
```bash
FRONTEND_URL=https://fincenclear.com
```

---

## PART 5: Update Email Configuration (If Applicable)

If SendGrid or email service sends links, ensure they use the production domain:

**File:** `api/app/services/email.py` (or similar)

```python
import os

FRONTEND_URL = os.getenv("FRONTEND_URL", "https://fincenclear.com")

def send_party_invitation(party_email: str, token: str, property_address: str):
    portal_link = f"{FRONTEND_URL}/p/{token}"
    
    # Email content uses portal_link
    ...
```

---

## PART 6: Verification Checklist

After deployment, verify:

- [ ] `https://fincenclear.com` loads the landing page
- [ ] `https://www.fincenclear.com` redirects to or loads the site
- [ ] Login works (no CORS errors)
- [ ] Client form submission works (no CORS errors)
- [ ] Admin queue loads data (no CORS errors)
- [ ] Party portal links use the new domain
- [ ] Page metadata shows correctly (check with browser dev tools)

---

## PART 7: DNS Configuration Reference

**At your domain registrar (GoDaddy, Namecheap, Cloudflare, etc.):**

For Vercel:
```
Type    Name    Value                      TTL
A       @       76.76.21.21                Auto
CNAME   www     cname.vercel-dns.com       Auto
```

For Render API (if setting up api.fincenclear.com later):
```
Type    Name    Value                                    TTL
CNAME   api     pct-fin-cen-staging.onrender.com        Auto
```

---

## PART 8: Update KilledSharks.md

```markdown
---

### 14. Custom Domain Configuration âœ…

**Task:** Configure production domain `fincenclear.com`

**Changes Made:**

1. **CORS Configuration**
   - Added `https://fincenclear.com` to allowed origins
   - Added `https://www.fincenclear.com` to allowed origins
   - Made CORS configurable via environment variable

2. **Environment Variables**
   - Frontend: Added `NEXT_PUBLIC_SITE_URL`
   - Backend: Added `FRONTEND_URL` for generated links
   - Backend: Added `ALLOWED_ORIGINS` for flexible CORS

3. **Metadata & SEO**
   - Updated `metadataBase` to production domain
   - Added OpenGraph and Twitter card metadata
   - Added proper site description and keywords

4. **Dynamic URL Generation**
   - Party portal links now use `FRONTEND_URL` env var
   - Email links use production domain

**Files Changed:**
- `api/app/main.py` (CORS)
- `web/.env.production` (new)
- `web/app/layout.tsx` (metadata)
- `api/app/services/email.py` (if exists)
- `api/app/routes/reports.py` (party link generation)

**DNS Records Added:**
- A record: @ â†’ 76.76.21.21 (Vercel)
- CNAME: www â†’ cname.vercel-dns.com

**Test:**
- Visit https://fincenclear.com âœ“
- Submit form (no CORS) âœ“
- Check OpenGraph preview âœ“

**Status:** âœ… Killed
```

---

## SUMMARY: What to Do

### In Code (Cursor handles):
1. Update CORS in `api/app/main.py`
2. Create/update `web/.env.production`
3. Update metadata in `web/app/layout.tsx`
4. Update any hardcoded URLs

### In Dashboards (You handle manually):
1. **Vercel:** Add domain `fincenclear.com` in project settings
2. **Render:** Add `ALLOWED_ORIGINS` and `FRONTEND_URL` env vars
3. **Domain Registrar:** Add DNS records

### After Everything:
1. Wait for DNS propagation (usually 5-15 minutes)
2. Test the full flow on `https://fincenclear.com`
3. Celebrate! ðŸŽ‰
